{% comment %}
  ZEN PORTAL HERO v1 — Benessere Zen (OS 2.0 / Eurus)
  Focus: eleganza + funnel primario (Bellezza / Oggettistica & Idee Regalo / Quiz)
  A11y & perf: HTML semantico, overlay regolabile, lazy image, JS minimale
  Dipendenze facoltative: snippet 'icon-zen' per le icone USP
{% endcomment %}

{% assign _sid = section.id %}
<section id="zen-portal-hero-{{ _sid }}" class="zen-portal-hero" role="region" aria-label="Ingresso Benessere Zen">
  <div class="zph-bg" aria-hidden="true">
    {% if section.settings.bg_video_mp4 != blank %}
      <video class="zph-video" playsinline muted loop preload="metadata"
             {% if section.settings.autoplay %}autoplay{% endif %}
             poster="{{ section.settings.bg_image | image_url: width: 1200 }}">
        <source src="{{ section.settings.bg_video_mp4 }}" type="video/mp4">
      </video>
    {% elsif section.settings.bg_image %}
      {{ section.settings.bg_image | image_url: width: 2400 | image_tag: class: 'zph-image', loading: 'lazy', fetchpriority: 'high', alt: section.settings.heading | escape }}
    {% endif %}
    <div class="zph-overlay"></div>
  </div>

  <div class="zph-inner container">
    <header class="zph-head">
      {% if section.settings.kicker != blank %}
        <p class="zph-kicker">{{ section.settings.kicker }}</p>
      {% endif %}
      {% if section.settings.heading != blank %}
        <h1 class="zph-title">{{ section.settings.heading }}</h1>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <p class="zph-sub">{{ section.settings.subheading }}</p>
      {% endif %}

      {% if section.blocks.size > 0 %}
      <ul class="zph-usps" aria-label="I nostri punti di forza">
        {% for block in section.blocks %}
          {% if block.type == 'usp' %}
          <li class="zph-usp" {{ block.shopify_attributes }}>
            {% if block.settings.icon != 'none' %}
              <span class="zph-ic" aria-hidden="true">{% render 'icon-zen', name: block.settings.icon %}</span>
            {% endif %}
            <span class="zph-usp-txt">{{ block.settings.text }}</span>
          </li>
          {% endif %}
        {% endfor %}
      </ul>
      {% endif %}

      {% if section.settings.quiz_label != blank and section.settings.quiz_url != blank %}
      <div class="zph-cta">
        <a class="btn btn-primary" href="{{ section.settings.quiz_url }}">{{ section.settings.quiz_label }}</a>
      </div>
      {% endif %}
    </header>

    <div class="zph-portals" role="navigation" aria-label="Seleziona area">
      {% assign portals = (1..2) %}
      {% for i in portals %}
        {% assign t = 'card' | append: i %}

        {%- assign key_title = t | append: '_title' -%}
        {%- assign key_badge = t | append: '_badge' -%}
        {%- assign key_link  = t | append: '_link'  -%}
        {%- assign key_image = t | append: '_image' -%}

        {%- assign card_title = section.settings[key_title] -%}
        {%- assign card_badge = section.settings[key_badge] -%}
        {%- assign card_link  = section.settings[key_link]  -%}
        {%- assign card_img   = section.settings[key_image] -%}

        <a class="zph-card" href="{{ card_link }}" aria-label="Vai a {{ card_title }}">
          <figure class="zph-card-fig">
            {% if card_img %}
              {{ card_img | image_url: width: 1200 | image_tag: class: 'zph-card-img', loading: 'lazy', alt: card_title }}
            {% endif %}
            <figcaption class="zph-card-cap">
              {% if card_badge != blank %}
                <span class="zph-badge">{{ card_badge }}</span>
              {% endif %}
              <span class="zph-card-title">{{ card_title }}</span>
              <span class="zph-card-cta">{{ section.settings.card_cta_label }}</span>
            </figcaption>
          </figure>
          <span class="zph-focus-ring" aria-hidden="true"></span>
        </a>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  #zen-portal-hero-{{ _sid }} { --zph-text: {{ section.settings.text_color }}; --zph-accent: {{ section.settings.accent_color }}; --zph-overlay: {{ section.settings.overlay_color }}; --zph-overlay-a: {{ section.settings.overlay_alpha }}; }
  #zen-portal-hero-{{ _sid }} { position: relative; color: var(--zph-text); }
  #zen-portal-hero-{{ _sid }} .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
  #zen-portal-hero-{{ _sid }} .zph-bg { position:absolute; inset:0; overflow:hidden; }
  #zen-portal-hero-{{ _sid }} .zph-image, #zen-portal-hero-{{ _sid }} .zph-video { width:100%; height:100%; object-fit:cover; display:block; }
  #zen-portal-hero-{{ _sid }} .zph-overlay { position:absolute; inset:0; background: var(--zph-overlay); opacity: var(--zph-overlay-a); }
  #zen-portal-hero-{{ _sid }} .zph-inner { position: relative; z-index: 2; }
  #zen-portal-hero-{{ _sid }} .zph-head { text-align:center; max-width: 920px; margin: 0 auto 28px; }
  #zen-portal-hero-{{ _sid }} .zph-kicker { letter-spacing:.14em; text-transform:uppercase; font-size:.76rem; opacity:.9; margin:0 0 10px; }
  #zen-portal-hero-{{ _sid }} .zph-title { font-size: clamp(28px, 5vw, 48px); line-height:1.08; margin:0 0 10px; }
  #zen-portal-hero-{{ _sid }} .zph-sub { font-size: clamp(15px, 2.2vw, 18px); opacity:.95; margin:0 auto 16px; }
  #zen-portal-hero-{{ _sid }} .zph-usps { display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:0 0 16px;padding:0; list-style:none; }
  #zen-portal-hero-{{ _sid }} .zph-usp { display:inline-flex; align-items:center; gap:8px; background: color-mix(in srgb, var(--zph-overlay) 0%, #fff 10%);
    border:1px solid rgba(255,255,255,.2); backdrop-filter:saturate(120%) blur(6px); padding:8px 12px; border-radius:999px; font-size:.9rem; }
  #zen-portal-hero-{{ _sid }} .zph-ic { display:inline-flex; width:18px; height:18px; }
  #zen-portal-hero-{{ _sid }} .zph-cta { margin: 12px 0 0; }
  #zen-portal-hero-{{ _sid }} .btn { display:inline-flex; align-items:center; justify-content:center; padding:12px 18px; border-radius:999px; border:1px solid transparent; text-decoration:none; font-weight:600; }
  #zen-portal-hero-{{ _sid }} .btn-primary { background: var(--zph-accent); color: #fff; box-shadow: 0 10px 28px rgba(0,0,0,.16); }
  #zen-portal-hero-{{ _sid }} .btn-primary:focus-visible { outline: 2px solid #fff; outline-offset:2px; }

  #zen-portal-hero-{{ _sid }} .zph-portals { display:grid; grid-template-columns: 1fr; gap:14px; margin:18px 0 0; }
  @media (min-width: 740px){ #zen-portal-hero-{{ _sid }} .zph-portals{ grid-template-columns: repeat(2,1fr);} }
  #zen-portal-hero-{{ _sid }} .zph-card { position:relative; display:block; border-radius:18px; overflow:hidden; color:inherit; text-decoration:none; outline:none; }
  #zen-portal-hero-{{ _sid }} .zph-card:focus-visible .zph-focus-ring{ opacity:1; }
  #zen-portal-hero-{{ _sid }} .zph-card-fig { margin:0; }
  #zen-portal-hero-{{ _sid }} .zph-card-img { width:100%; height: clamp(220px, 30vw, 360px); object-fit:cover; display:block; }
  #zen-portal-hero-{{ _sid }} .zph-card-cap { position:absolute; inset:auto 0 0 0; padding:18px; display:flex; flex-direction:column; gap:6px;
    background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,.2) 36%, rgba(0,0,0,.5) 100%); color:#fff; }
  #zen-portal-hero-{{ _sid }} .zph-badge { align-self:flex-start; background: #ffffff; color:#111; padding:6px 10px; border-radius:999px; font-size:.78rem; font-weight:600; }
  #zen-portal-hero-{{ _sid }} .zph-card-title { font-size: clamp(18px, 2.6vw, 22px); font-weight:700; }
  #zen-portal-hero-{{ _sid }} .zph-card-cta { font-size:.92rem; opacity:.95; text-decoration: underline; }
  #zen-portal-hero-{{ _sid }} .zph-focus-ring { position:absolute; inset:0; border:2px solid #fff; border-radius:18px; box-shadow:0 0 0 4px rgba(255,255,255,.35); opacity:0; transition:opacity .2s; pointer-events:none; }
</style>

<script>
  (function(){
    const sec = document.getElementById('zen-portal-hero-{{ _sid }}');
    if(!sec) return;
    const media = sec.querySelector('.zph-video');
    try {
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches && media) {
        media.removeAttribute('autoplay');
      }
    } catch(e) {}
  })();
</script>

{% schema %}
{
  "name": "Zen Portal Hero v1",
  "tag": "section",
  "class": "section zen-portal-hero-section",
  "settings": [
    { "type": "text", "id": "kicker", "label": "Kicker (sopratitolo)", "default": "Benessere naturale" },
    { "type": "text", "id": "heading", "label": "Titolo", "default": "Rituali di bellezza e doni consapevoli" },
    { "type": "textarea", "id": "subheading", "label": "Sottotitolo", "default": "Scopri la nostra selezione Bellezza e Oggettistica & Idee Regalo. Ingredienti naturali, design elegante, risultati reali." },

    { "type": "image_picker", "id": "bg_image", "label": "Immagine di sfondo" },
    { "type": "text", "id": "bg_video_mp4", "label": "Video MP4 (URL CDN)", "info": "Opzionale. Se presente, sostituisce l'immagine" },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay video", "default": true },

    { "type": "color", "id": "text_color", "label": "Colore testo", "default": "#ffffff" },
    { "type": "color", "id": "accent_color", "label": "Colore accento (CTA)", "default": "#2c7a7b" },
    { "type": "color", "id": "overlay_color", "label": "Colore overlay", "default": "#0b0b0b" },
    { "type": "range", "id": "overlay_alpha", "label": "Opacità overlay", "min": 0, "max": 0.9, "step": 0.1, "default": 0.3 },

    { "type": "text", "id": "quiz_label", "label": "Etichetta pulsante Quiz", "default": "Fai il quiz e scopri il tuo rituale" },
    { "type": "url",  "id": "quiz_url", "label": "Link al Quiz" },

    { "type": "header", "content": "Card 1 (Bellezza)" },
    { "type": "image_picker", "id": "card1_image", "label": "Immagine" },
    { "type": "text", "id": "card1_title", "label": "Titolo", "default": "Bellezza (Skincare)" },
    { "type": "text", "id": "card1_badge", "label": "Badge (opzionale)", "default": "Novità" },
    { "type": "url",  "id": "card1_link", "label": "Link" },

    { "type": "header", "content": "Card 2 (Oggettistica & Regali)" },
    { "type": "image_picker", "id": "card2_image", "label": "Immagine" },
    { "type": "text", "id": "card2_title", "label": "Titolo", "default": "Oggettistica & Idee Regalo" },
    { "type": "text", "id": "card2_badge", "label": "Badge (opzionale)", "default": "Regali sotto €30" },
    { "type": "url",  "id": "card2_link", "label": "Link" },

    { "type": "text", "id": "card_cta_label", "label": "Testo CTA delle card", "default": "Scopri" }
  ],
  "blocks": [
    {
      "type": "usp",
      "name": "USP",
      "limit": 6,
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icona",
          "default": "leaf",
          "options": [
            { "value": "leaf", "label": "Foglia" },
            { "value": "truck", "label": "Spedizione" },
            { "value": "shield", "label": "Garanzia" },
            { "value": "sparkle", "label": "Brilla" },
            { "value": "none", "label": "Nessuna" }
          ]
        },
        { "type": "text", "id": "text", "label": "Testo", "default": "Ingredienti naturali selezionati" }
      ]
    }
  ],
  "presets": [
    { "name": "Home – Funnel Primario (Hero)", "category": "Hero" }
  ]
}
{% endschema %}